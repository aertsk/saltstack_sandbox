# Step 1: Get familiar with saltstack
https://www.tutorialspoint.com/saltstack

# On salt_master: restart saltstack
service salt-master restart

# On salt_minion: restart saltstack
service salt-minion restart

# On salt_master: Check keys
salt-key -L

# On salt_master: Accept all keys (NOT SECURE!!!!)
# Can be persisted in master config file using 'open_mode: True'
salt-key -A

# Test salt connectivity
salt '*' test.ping

# Deploy /srv/salt/test.sls Salt State
salt '*' state.apply ci_jenkins

# Step 2: How to deploy a docker using saltstack

# Deploy docker on minion:
salt 'salt_minion' state.sls dock_nginx

# TIPS:
############

# On salt_minion: Remove minion key
####################################

#Inside dockerised minion
rm /etc/salt/pki/minion/*

#On target minion
rm -rf /var/lib/salt/pki/minion

# Install pip
salt 'salt_minion' pip.install docker-py

salt 'salt_minion' docker.exists nginx
salt 'salt_minion' dockerng.start nginx

# Does not work for some reason in sls file:
####################################

python-pip-pkg:
  pkg.installed:
    - name: python-pip
    - version: 8.1.1

docker-py:
  pip.installed:
    - require:
      - pkg: python-pip
